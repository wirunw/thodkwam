<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ñ‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --apple-blue: #0071e3;
            --apple-gray: #555555;
            --apple-light-gray: #f5f5f7;
            --apple-text: #000000;
            --apple-secondary-text: #444444;
            --apple-accent: #0071e3;
            --apple-success: #20a13a;
            --apple-warning: #ff8c00;
            --apple-danger: #ff2d20;
        }
        
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            color: var(--apple-text);
        }
        
        /* Glassmorphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(220, 220, 220, 0.6);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(200, 200, 200, 0.7);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .glass-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        /* Custom styles for glowing dot */
        .glowing-dot {
            width: 12px;
            height: 12px;
            background-color: var(--apple-danger);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 10px var(--apple-danger);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 69, 58, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 69, 58, 0); }
        }
        
        /* Apple-style sliders */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: #d1d1d6;
            border-radius: 2px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--apple-blue);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        
        /* Textarea focus effect */
        textarea:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--apple-blue);
        }
        
        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Apple-style loading animation */
        .loading-pulse {
            animation: loadingPulse 1.5s infinite ease-in-out;
        }
        
        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-4xl glass-card p-6 md:p-8 space-y-8">
        
        <header class="text-center">
            <div class="w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center shadow-lg">
                <i class="fas fa-microphone-alt text-white text-2xl"></i>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-2">‡∏ñ‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°</h1>
            <p class="text-gray-600 text-lg max-w-2xl mx-auto">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß</p>
            <div class="mt-3 bg-amber-50 border border-amber-200 text-amber-800 p-3 rounded-xl glass-button text-sm">
                <i class="fas fa-info-circle mr-2"></i>
                ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
            </div>
        </header>

        <!-- Error message for unsupported browsers -->
        <div id="unsupported-message" class="hidden bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl glass-button" role="alert">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                <p class="font-semibold">‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢!</p>
            </div>
            <p class="mt-1">‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Web Speech API ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ Google Chrome ‡∏´‡∏£‡∏∑‡∏≠ Microsoft Edge ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
        </div>

        <main id="app-container" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Speech-to-Text Section -->
            <div class="glass-card p-6 flex flex-col">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3">
                        <i class="fas fa-microphone text-green-600"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-900">‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>
                </div>
                
                <div class="mb-4">
                    <label for="lang-select" class="block text-sm font-medium text-gray-900 mb-2 flex items-center">
                        <i class="fas fa-globe mr-2 text-gray-700"></i>
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏π‡∏î
                    </label>
                    <select id="lang-select" class="w-full p-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all appearance-none cursor-pointer">
                        <option value="th-TH" selected>‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                        <option value="en-US">English (US)</option>
                        <option value="en-GB">English (UK)</option>
                        <option value="ja-JP">Êó•Êú¨Ë™û (‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô)</option>
                        <option value="ko-KR">ÌïúÍµ≠Ïñ¥ (‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ)</option>
                        <option value="zh-CN">‰∏≠Êñá (‡∏à‡∏µ‡∏ô)</option>
                    </select>
                </div>

                <div class="flex flex-col flex-grow">
                    <div class="relative flex-grow bg-white p-3 rounded-xl border border-gray-300 min-h-[180px] mb-4">
                        <textarea id="transcript" class="w-full h-full text-gray-900 bg-transparent resize focus:outline-none p-3" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                        <div id="char-counter" class="absolute bottom-3 right-4 text-sm text-gray-600 flex items-center">
                            <i class="fas fa-font mr-1"></i>
                            <span>0 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button id="listen-button" class="glass-button py-3 px-4 rounded-xl font-semibold text-green-700 border border-green-300 transition-all shadow-sm flex items-center justify-center gap-2">
                             <i class="fas fa-microphone"></i>
                            <span id="listen-text">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á</span>
                        </button>
                        <button id="copy-button" class="glass-button py-3 px-4 rounded-xl font-semibold text-indigo-700 border border-indigo-300 transition-all shadow-sm flex items-center justify-center gap-2">
                           <i class="fas fa-copy"></i>
                            <span id="copy-text">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</span>
                        </button>
                        <button id="save-button" class="glass-button py-3 px-4 rounded-xl font-semibold text-teal-700 border border-teal-300 transition-all shadow-sm flex items-center justify-center gap-2">
                            <i class="fas fa-download"></i>
                            <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                        </button>
                        <button id="clear-button" class="glass-button py-3 px-4 rounded-xl font-semibold text-red-600 border border-red-300 transition-all shadow-sm flex items-center justify-center gap-2">
                            <i class="fas fa-trash"></i>
                            <span>‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
                        </button>
                        <button id="read-aloud-button" class="col-span-2 glass-button py-3 px-4 rounded-xl font-semibold text-amber-700 border border-amber-300 transition-all shadow-sm flex items-center justify-center gap-2">
                            <i class="fas fa-volume-high"></i>
                            <span>‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á</span>
                        </button>
                    </div>
                    
                    <div id="listening-indicator" class="hidden flex items-center justify-center gap-2 mt-4 text-red-500">
                        <div class="glowing-dot"></div>
                        <span class="font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...</span>
                    </div>
                </div>
            </div>

            <!-- Text-to-Speech Section -->
            <div class="glass-card p-6 flex flex-col">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                        <i class="fas fa-font text-blue-700"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-900">‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</h2>
                </div>
                
                <div class="space-y-5 flex-grow">
                    <div>
                        <label for="text-to-speak" class="block text-sm font-medium text-gray-900 mb-2 flex items-center">
                            <i class="fas fa-keyboard mr-2 text-gray-700"></i>
                            ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                        </label>
                        <textarea 
                            id="text-to-speak" 
                            rows="5" 
                            class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize"
                            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©...">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏≠‡∏õ‡∏ñ‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°</textarea>
                    </div>

                    <div>
                        <label for="voice-select" class="block text-sm font-medium text-gray-900 mb-2 flex items-center">
                            <i class="fas fa-user-voice mr-2 text-gray-700"></i>
                            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                        </label>
                        <select id="voice-select" class="w-full p-3 bg-white border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all appearance-none cursor-pointer">
                            <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á...</option>
                        </select>
                        <p class="text-sm text-gray-700 mt-2 flex items-center">
                            <i class="fas fa-info-circle mr-1"></i>
                            * ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                        </p>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label for="rate" class="block text-sm font-medium text-gray-900 mb-2 flex items-center">
                                <i class="fas fa-tachometer-alt mr-2 text-gray-700"></i>
                                ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: <span id="rate-value" class="font-bold ml-1">1.0</span>
                            </label>
                            <input type="range" id="rate" min="0.1" max="2" value="1.0" step="0.1" class="w-full">
                        </div>
                        
                        <div>
                            <label for="pitch" class="block text-sm font-medium text-gray-900 mb-2 flex items-center">
                                <i class="fas fa-volume-up mr-2 text-gray-700"></i>
                                ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á: <span id="pitch-value" class="font-bold ml-1">1.0</span>
                            </label>
                            <input type="range" id="pitch" min="0" max="2" value="1.0" step="0.1" class="w-full">
                        </div>
                    </div>

                    <div class="flex items-center gap-4 pt-4">
                        <button id="speak-button" class="flex-grow glass-button py-3 px-4 rounded-xl font-semibold text-blue-700 border border-blue-300 hover:bg-blue-50 transition-all shadow-sm">
                            <i class="fas fa-play mr-2"></i>
                            ‡∏û‡∏π‡∏î
                        </button>
                        <button id="stop-button" class="flex-grow glass-button py-3 px-4 rounded-xl font-semibold text-gray-700 border border-gray-300 hover:bg-gray-50 transition-all shadow-sm">
                            <i class="fas fa-stop mr-2"></i>
                            ‡∏´‡∏¢‡∏∏‡∏î
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- How to Use Section -->
    <div class="w-full max-w-4xl glass-card p-6 md:p-8 mt-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center flex items-center justify-center">
            <i class="fas fa-question-circle mr-3 text-blue-500"></i>
            ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-button p-5 rounded-xl border border-green-200 transition-all">
                <div class="flex items-start mb-3">
                    <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3 flex-shrink-0">
                        <i class="fas fa-microphone text-green-700"></i>
                    </div>
                    <h4 class="font-semibold text-lg text-gray-900">üé§ ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h4>
                </div>
                <ol class="list-decimal list-inside space-y-2 text-gray-800 pl-2">
                    <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</li>
                    <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <span class="font-semibold text-green-700">'‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á'</span> ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏π‡∏î</li>
                    <li>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ <span class="font-semibold text-amber-600">'‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á'</span> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏ß‡∏ô</li>
                    <li>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç, <span class="font-semibold text-indigo-700">'‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å'</span>, ‡∏´‡∏£‡∏∑‡∏≠ <span class="font-semibold text-teal-700">'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'</span> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</li>
                </ol>
            </div>
            <div class="glass-button p-5 rounded-xl border border-blue-200 transition-all">
                <div class="flex items-start mb-3">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3 flex-shrink-0">
                        <i class="fas fa-font text-blue-700"></i>
                    </div>
                    <h4 class="font-semibold text-lg text-gray-900">üîä ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</h4>
                </div>
                <ol class="list-decimal list-inside space-y-2 text-gray-800 pl-2">
                    <li>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢</li>
                    <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</li>
                    <li>‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</li>
                    <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <span class="font-semibold text-blue-700">'‡∏û‡∏π‡∏î'</span> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á</li>
                </ol>
            </div>
        </div>
    </div>


    <footer class="text-center text-gray-700 text-base py-6 mt-8">
        <div class="flex flex-col items-center">
            <img src="https://i.postimg.cc/dDfBQVWf/wirun-facbook.png" alt="Logo ‡∏ñ‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°" class="mx-auto mb-3 w-16 h-16 rounded-full object-cover shadow-md">
            <p>‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏ß‡∏¥‡∏£‡∏∏‡∏ì ‡πÄ‡∏ß‡∏ä‡∏®‡∏¥‡∏£‡∏¥</p>
            <div class="flex flex-col items-center mt-2">
                <a href="http://www.pharmconnection.net" target="_blank" class="text-indigo-700 hover:text-indigo-900 transition-colors text-base mb-1">
                    <i class="fas fa-globe mr-1"></i>www.pharmconnection.net
                </a>
                <a href="https://www.linkedin.com/in/wirunw/" target="_blank" class="text-blue-700 hover:text-blue-900 transition-colors text-base">
                    <i class="fab fa-linkedin mr-1"></i>LinkedIn Profile
                </a>
            </div>
            <div class="flex space-x-4 mt-3 text-gray-600">
                <i class="fab fa-apple text-lg"></i>
                <i class="fab fa-microsoft text-lg"></i>
                <i class="fab fa-google text-lg"></i>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const synth = window.speechSynthesis;
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            // Check for browser support
            if (!synth || !SpeechRecognition) {
                document.getElementById('app-container').classList.add('hidden');
                document.getElementById('unsupported-message').classList.remove('hidden');
                console.error("Web Speech API is not supported in this browser.");
                return;
            }

            // --- TEXT-TO-SPEECH ---
            const textToSpeakInput = document.getElementById('text-to-speak');
            const voiceSelect = document.getElementById('voice-select');
            const rateInput = document.getElementById('rate');
            const rateValue = document.getElementById('rate-value');
            const pitchInput = document.getElementById('pitch');
            const pitchValue = document.getElementById('pitch-value');
            const speakButton = document.getElementById('speak-button');
            const stopButton = document.getElementById('stop-button');

            let voices = [];
            const utterance = new SpeechSynthesisUtterance();

            function populateVoiceList() {
                voices = synth.getVoices();
                voiceSelect.innerHTML = '';
                
                const thaiVoices = voices.filter(voice => voice.lang.includes('th-TH'));
                const otherVoices = voices.filter(voice => !voice.lang.includes('th-TH'));

                if (thaiVoices.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢';
                    thaiVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.textContent = `${voice.name} (${voice.lang})`;
                        option.setAttribute('data-lang', voice.lang);
                        option.setAttribute('data-name', voice.name);
                        optgroup.appendChild(option);
                    });
                    voiceSelect.appendChild(optgroup);
                    
                    // Set the first Thai voice as default if available
                    voiceSelect.selectedIndex = 1; // Skip the optgroup label
                }
                
                const otherOptgroup = document.createElement('optgroup');
                otherOptgroup.label = '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
                otherVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.setAttribute('data-lang', voice.lang);
                    option.setAttribute('data-name', voice.name);
                    otherOptgroup.appendChild(option);
                });
                voiceSelect.appendChild(otherOptgroup);
                
                // Update voice selection placeholder if no voice is selected
                if (voiceSelect.options.length === 0) {
                    voiceSelect.innerHTML = '<option value="">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</option>';
                } else if (voiceSelect.selectedIndex === -1) {
                    // If no Thai voices found, select the first available voice
                    voiceSelect.selectedIndex = 0;
                }
            }

            populateVoiceList();
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = populateVoiceList;
            }

            function speak() {
                if (synth.speaking) {
                    synth.cancel();
                }
                if (textToSpeakInput.value !== '') {
                    utterance.text = textToSpeakInput.value;
                    const selectedVoiceName = voiceSelect.selectedOptions[0].getAttribute('data-name');
                    utterance.voice = voices.find(voice => voice.name === selectedVoiceName);
                    utterance.pitch = parseFloat(pitchInput.value);
                    utterance.rate = parseFloat(rateInput.value);
                    synth.speak(utterance);
                }
            }
            
            speakButton.addEventListener('click', speak);
            stopButton.addEventListener('click', () => synth.cancel());
            rateInput.addEventListener('input', () => rateValue.textContent = parseFloat(rateInput.value).toFixed(1));
            pitchInput.addEventListener('input', () => pitchValue.textContent = parseFloat(pitchInput.value).toFixed(1));

            // --- SPEECH-TO-TEXT ---
            const recognition = new SpeechRecognition();
            const listenButton = document.getElementById('listen-button');
            const listenText = document.getElementById('listen-text');
            const listeningIndicator = document.getElementById('listening-indicator');
            const transcriptOutput = document.getElementById('transcript');
            const copyButton = document.getElementById('copy-button');
            const copyButtonText = document.getElementById('copy-text');
            const langSelect = document.getElementById('lang-select');
            const charCounter = document.getElementById('char-counter');
            const saveButton = document.getElementById('save-button');
            const clearButton = document.getElementById('clear-button');
            const readAloudButton = document.getElementById('read-aloud-button');

            let isListening = false;
            let isUserStopped = false; // Track if user manually stopped
            let finalTranscript = '';
            let restartTimeout = null; // Store timeout reference to prevent multiple restarts

            recognition.lang = 'th-TH'; // Set default to Thai
            recognition.interimResults = true;
            recognition.continuous = true;
            
            function updateCounter() {
                const count = transcriptOutput.value.length;
                charCounter.innerHTML = `<i class="fas fa-font mr-1"></i><span>${count} ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>`;
            }

            recognition.onresult = (event) => {
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript + ' ';
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                
                transcriptOutput.value = finalTranscript + interimTranscript;
                updateCounter();
            };

            recognition.onstart = () => {
                isListening = true;
                isUserStopped = false; // Reset when actually starting
                listenText.textContent = '‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏±‡∏á';
                listenButton.classList.remove('text-green-600', 'border-green-200', 'hover:bg-green-50');
                listenButton.classList.add('text-red-600', 'border-red-200', 'hover:bg-red-50');
                listeningIndicator.classList.remove('hidden');
            };

            recognition.onend = () => {
                if (isUserStopped) {
                    // User manually stopped
                    isListening = false;
                    listenText.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á';
                    listenButton.classList.remove('text-red-600', 'border-red-200', 'hover:bg-red-50');
                    listenButton.classList.add('text-green-600', 'border-green-200', 'hover:bg-green-50');
                    listeningIndicator.classList.add('hidden');
                } else {
                    // Recognition ended automatically (e.g., timeout), restart after a delay
                    if (restartTimeout) {
                        clearTimeout(restartTimeout);
                    }
                    restartTimeout = setTimeout(() => {
                        if (isListening && !isUserStopped) {
                            recognition.lang = langSelect.value;
                            recognition.start();
                        }
                    }, 300);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    alert('‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
                    isUserStopped = true;
                    recognition.stop();
                } else if (event.error === 'no-speech' || event.error === 'audio-capture') {
                    // If no speech detected or audio capture issues, try to restart
                    if (isListening && !isUserStopped && !isUserStopped) {
                        setTimeout(() => {
                            if (isListening && !isUserStopped) {
                                recognition.lang = langSelect.value;
                                recognition.start();
                            }
                        }, 500);
                    }
                }
            };

            listenButton.addEventListener('click', () => {
                if (isListening) {
                    // User manually stopping
                    isUserStopped = true;
                    if (restartTimeout) {
                        clearTimeout(restartTimeout);
                    }
                    recognition.stop();
                } else {
                    // User starting
                    recognition.lang = langSelect.value;
                    recognition.start();
                }
            });
            
            langSelect.addEventListener('change', () => {
                recognition.lang = langSelect.value;
            });
            
            // Set default language selection to Thai
            langSelect.value = 'th-TH';

            copyButton.addEventListener('click', () => {
                if (transcriptOutput.value) {
                    transcriptOutput.select();
                    transcriptOutput.setSelectionRange(0, 99999); 
                    try {
                        document.execCommand('copy');
                        copyButtonText.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
                        copyButton.classList.remove('text-indigo-600', 'border-indigo-200', 'hover:bg-indigo-50');
                        copyButton.classList.add('text-green-600', 'border-green-200', 'hover:bg-green-50');
                        setTimeout(() => {
                            copyButtonText.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å';
                            copyButton.classList.remove('text-green-600', 'border-green-200', 'hover:bg-green-50');
                            copyButton.classList.add('text-indigo-600', 'border-indigo-200', 'hover:bg-indigo-50');
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ');
                    }
                    window.getSelection().removeAllRanges();
                }
            });

            clearButton.addEventListener('click', () => {
                finalTranscript = '';
                transcriptOutput.value = '';
                updateCounter();
            });

            saveButton.addEventListener('click', () => {
                const textToSave = transcriptOutput.value;
                if (textToSave) {
                    const blob = new Blob([textToSave], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = '‡∏ñ‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°.txt';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }
            });

            readAloudButton.addEventListener('click', () => {
                if (synth.speaking) {
                    synth.cancel();
                }
                const textToRead = transcriptOutput.value;
                if (textToRead !== '') {
                    utterance.text = textToRead;
                    const selectedVoiceName = voiceSelect.selectedOptions[0].getAttribute('data-name');
                    utterance.voice = voices.find(voice => voice.name === selectedVoiceName);
                    utterance.pitch = parseFloat(pitchInput.value);
                    utterance.rate = parseFloat(rateInput.value);
                    synth.speak(utterance);
                }
            });
            
            transcriptOutput.addEventListener('input', updateCounter);
            updateCounter();
        });
    </script>
</body>
</html>

